# 타임라인 격리하기

## 타임라인 다이어그램은 시간에 따라 어떤 일이 일어나는지 보여준다.
- **타임라인**은 액션을 순서대로 나열한 것이다.
- **타임라인 다이어그램**은 시간에 따라 액션 순서를 시각적으로 표시한 것이다.

## 두 가지 타임라인 다이어그램 기본 규칙
- 순서대로 실행되는 액션과 동시에 나란히 실행되는 액션을 알 수 있다.
  - 두 액션이 순서대로 나타나면 같은 타임라인에 넣는다.
  - 두 액션이 동시에 실행되거나 순서를 예상할 수 없다면 분리된 타임라인에 넣는다.

## 자세히 보지 않으면 놓칠 수 있는 액션 순서에 관한 두 가지
**1. ++와 +=는 사실 세 단계이다.**
```js
var temp = total; // 읽기(액션)
temp = temp + 1; // 더하기(계산)
total = temp; // 쓰기(액션)
```
- 두 번째 단계인 1을 더하는 동작은 계산이다. 따라서 다이어그램에 표시하지 않는다.
- 읽기와 쓰기, 두 개의 액션으로 다이어그램에 표시해야 한다.

**2. 인자는 함수를 부르기 전에 실행한다.**
```js
console.log(total)

// 실제 동작
var temp = total;
console.log(temp);
```
- 전역변수를 읽어(액션) 값을 로깅하는(액션) 코드이다.

## 타임 라인 그리기
- 타임라인 다이어그램은 모두 세 단계로 그린다.

1. 액션을 확인한다.
2. 순서대로 실행되거나 동시에 실행되는 액션을 그린다.
3. 플랫폼에 특화된 지식을 사용해 다이어그램을 단순하게 만든다.

- 비동기 호출은 새로운 타임 라인으로 그린다.

## 좋은 타임 라인의 원칙
#### 1. 타임 라인은 적을수록 이해하기 쉽다.
- 새로운 타임라인은 항상 시스템을 이해하기 어렵게 만든다.

#### 2. 타임라인은 짧을수록 이해하기 쉽다.
- 단계를 줄인다면 실행 가능한 순서의 수도 많이 줄일 수 있다.

#### 3. 공유하는 자원이 적을수록 이해하기 쉽다.
- 서로 다른 타임라인에 있는 두 액션이 서로 자원을 고유하지 않는다면 실행 순서에 신경 쓸 필요가 없다.

#### 4. 자원을 공유한다면 서로 조율해야 한다.
- 타임라인은 공유 자원을 안전하게 공유할 수 있어야 한다.
  - 안전하게 공유한다는 말은 올바른 순서대로 자원을 쓰고 돌려준다는 말이다.
- 전역변수를 지역변수로 바꿈으로써 문제를 해결할 수도 있다.

#### 5. 시간을 일급으로 다룬다.
- 타임라인 다루는 재사용 가능한 객체를 만들면 타이밍 문제를 쉽게 만들 수 있다.

## 자바스크립트의 비동기 큐
- 브라우저에서 동작하는 자바스크립트 엔진은 **작업 큐**(job queue)라고 하는 큐를 가지고 있다.
- 작업큐는 **이벤트 루프**(event loop)에 의해 처리된다.
- 이벤트 루프는 큐에서 작업 하나를 꺼내 실행하고 완료되면 다음 작업을 꺼내 실행하는 것을 무한히 반복한다.
- 이벤트 루프는 하나의 스레드에서 처리하기 때문에 두 개의 작업이 동시에 실행될 수 없다.

<br />

- 작업이란 무엇인가?
  - 작업은 이벤트 데이터와 이벤트를 처리할 콜백으로 구성되어 있다.
  - 이벤트 루프는 이벤트 데이터를 인자로 콜백을 부른다.
  - 이벤트 루프는 단순히 첫 번째 인자에 이벤트 데이터를 넣어 콜백 함수를 실행한다.
- 작업이 없을 때 엔진은 무엇을 할까?
  - 이벤트 루프는 대기 상태로 들어가고 전원을 아낀다.
  - 가비지 컬렉션 같은 관리 작업을 하기도 한다.

## 타임라인 단순화하기
#### 1. 하나의 타임라인에 있는 모든 액션을 하나로 통합한다.
- 자바스크립트는 스레드가 하나이기 때문에 액션은 순서가 섞이지 않고 하나의 타임 라인에서 실행된다.
- 타임 라인은 다른 타임 라인이 실행되기 전에 완료된다.
- 다이어그램에 점선이 있다면 타임라인 끝으로 옮긴다.

#### 2. 타임라인이 끝나는 곳에서 새로운 타임라인이 하나만 생긴다면 통합한다.


## 원칙: 비동기 호출에서 명시적인 출력을 위해 리턴값 대신 콜백을 사용할 수 있다.
- 비동기 호출에서 결괏값을 리턴값으로 줄 수 없다.
- 비동기 호출은 바로 리턴이 되지만 결괏값은 콜백이 호출되어야 얻을 수 있다.
- 결과가 준비되었을 때 결과를 인자에 넣어 콜백으로 호출 한다.