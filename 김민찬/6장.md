# 변경 가능한 데이터 구조를 가진 언어에서 불변성 유지하기

- 데이터가 바뀌지 않도록 하기 위해 카피-온-라이트를 적용한다.
- 배열과 객체를 데이터에 쓸 수 있는 카피-온-라이트 동작을 만든다.
- 깊이 중첩된 데이터도 카피-온-라이트가 잘 동작하게 만든다.

## 동작을 읽기, 쓰기 또는 둘 다로 분류하기

- 읽기
  - 데이터에서 정보를 가져온다.
  - 데이터를 바꾸지 않는다.
- 쓰기
  - 데이터를 바꾼다.

<br />

- 쓰기 동작은 불변성 원칙에 따라 구현해야 한다.
- 불변성 원칙은 **카피-온-라이트**(copy-on-write) 라고 한다.

## 카피-온-라이트 원칙 세 단계

1. 복사본 만들기
2. 복사본 변경하기
3. 복사본 리턴하기

- 예시

```js
function add_element_last(array, elem) {
  var new_array = array.slice();
  new_array.push(elem);
  return new_array;
}
```

- 데이터를 바꾸지 않았고 정보를 리턴했기 때문에 읽기로 변했다.
  - 카피-온-라이트는 쓰기를 읽기로 바꾼다.

## 쓰기도 하면서 읽기도 하는 동작은 어떻게 해야 할까?

1. 읽기와 쓰기 함수로 각각 분리한다.
2. 함수에서 값을 두 개 리턴한다.

- 선택할 수 있다면 첫 번째 접근 방법이 더 좋다.
- 책임이 확실히 분리되기 때문이다.
