# 계층형 설계 1

- **소프트웨어 설계(software design)**
  - 코드를 만들고, 테스트하고, 유지보수하기 쉬운 프로그래밍 방법을 선택하기 위해 미적 감각을 사용하는 것

- **계층형 설계**
  - 소프트웨어를 계층으로 구성하는 기술
  - 각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의한다.

## 설계 감각을 키우기

### 계층형 설계 감각을 키우기 위한 입력
- 함수 본문
  - 길이
  - 복잡성
  - 구체화 단계
  - 함수 호출
  - 프로그래밍 언어의 기능 사용
- 계층 구조
  - 화살표 길이
  - 응집도
  - 구체화 단계
- 함수 시그니쳐
  - 함수명
  - 인자 이름
  - 인잣값
  - 리턴값

### 계층형 설계 감각을 키우기 위한 출력
- 조직화
  - 새로운 함수를 어디에 놓을지 결정
  - 함수를 다른 곳으로 이동
- 구현
  - 구현 바꾸기
  - 함수 추출하기
  - 데이터 구조 바꾸기
- 변경
  - 새 코드를 작성할 곳 선택하기
  - 적절한 수준의 구체화 단계 결정하기

## 계층형 설계 패턴

### 패턴 1: 직접 구현
- 직접 구현된 함수를 읽을 때, 함수 시그니처가 나타내고 있는 문제를 함수 본문에서 적절한 구체화 수준에서 해결해야 한다.
- 너무 구체적이라면 코드에서 나는 냄새이다.

### 패턴 2: 추상화 벽
- 호출 그래프에 어떤 계층은 중요한 세부 구현을 감추고 인터페이스를 제공한다.
- 인터페이스를 사용하여 코드를 만들면 높은 차원으로 생각할 수 있다.

### 패턴 3: 작은 인터페이스
- 시스템이 커질수록 비지니스 개념을 나타내는 중요한 인터페이스는 작고 강력한 동작으로 구성하는 것이 좋다.
- 다른 동작도 직간접적으로 최소한의 인터페이스를 유지하면서 정의해야 한다.

### 패턴 4: 편리한 계층
- 계층형 설계 패턴과 실천 방법은 개발자의 요구를 만족시키면서 비즈니스 문제를 잘 풀 수 있어야 한다.
- 소프트웨어를 더 빠르고 고품질로 제공하는 데 도움이 되는 계층에 시간을 투자해야 한다.

## 패턴 1: 직접 구현
- 저수준의 코드(반복문 등)의 코드는 추출해야 할 가능성이 높다.
- 같은 계층에 있는 함수는 같은 목적을 가져야 한다.

## 3단계 줌 레벨
계층형 설계에서 문제는 세 가지 다른 영역에서 찾을 수 있다.
1. 계층 사이에 상호 관계
2. 특정 계층의 구현
3. 특정 함수의 구현


- 문제를 찾기 위해 알맞은 줌 레벨을 사용해 하나의 영역을 살펴 볼 수 있다.

#### 1. 전역 줌 레벨
- 전역 줌 레벨로 그래프 전체 중 필요한 부분을 살펴볼 수 있다.
- 기본 줌 레벨이다.
- 계층 사이에 상호 관계를 포함해서 모든 문제 영역을 살펴볼 수 있다.

#### 2. 계층 줌 레벨
- 한 계층과 연결된 바로 아래 계층을 볼 수 있는 줌 레벨이다.
- 계층 줌 레벨로 계층이 어떻게 구현되어 있는지 알 수 있다.

#### 3. 함수 줌 레벨
- 함수 하나와 바로 아래 연결된 함수들을 볼 수 있다.
- 함수 구현의 문제를 찾을 수 있다.
- 함수 하나를 살펴봤을 때 서로 다른 계층의 동작을 사용하면 직접 구현 패턴에 맞지 않는 것이다.

## 직접 구현 패턴 리뷰
- 직접 구현한 코드는 한 단계의 구체화 수준에 관한 문제만 해결한다.
  - 직접 구현하면 코드를 읽기 위해 알아야 하는 구체화 단계의 범위를 줄일 수 있다.
- 계층형 설계는 특정 구체화 단계에 집중할 수 있게 도와준다.
- 호출 그래프는 구체화 단계에 풍부한 단서를 보여준다.
  - 호출 그래프는 함수가 서로 어떻게 연결되어 있는지 보옂준다.
- 함수를 추출하면 더 일반적인 함수로 만들 수 있다.
  - 일반적인 함수는 구체적인 내용을 하나만 다루기 때문에 테스트하기 쉽다.
  - 명확한 코드와 알맞은 이름을 가진 함수는 더 읽기 쉽다.
- 일반적인 함수가 많을수록 재사용하기 좋다.
- 복잡성을 감추지 않는다.
  - 계층형 설계에서 모든 계층은 바로 아래 계층에 의존해야 한다.
