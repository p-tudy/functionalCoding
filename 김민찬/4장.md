# 액션에서 계산 빼내기

## 테스트하기 쉽게 만들기

- 액션에서 계산을 분리하지 않은 코드에서 MegaMart(가상의 회사) 테스트 과정

1. 브라우저 설정하기
2. 페이지 로드하기
3. 장바구니에 제품 담기 버튼 클릭
4. DOM이 업데이트될 때까지 기다리기
5. DOM에서 값 가져오기
6. 가져온 문자열 값을 숫자로 바꾸기
7. 예상하는 값과 비교하기

- 테스트를 더 쉽게하기 위한 조건
  - DOM 업데이트와 비즈니스 규칙은 분리되어야 한다.
  - 전역변수가 없어야 한다!

## 재사용하기 쉽게 만들기

- 전역변수에 의존하지 않아야 한다.
- DOM을 사용할 수 있는 곳에서 실행된다고 가정하면 안된다.
- 함수가 결괏값을 리턴해야 한다.

## 액션과 계산, 데이터를 구분하기

- 변경 가능한 전역변수는 액션이다.
- 전역변수를 바꾸는 것은 액션이다.
- DOM에서 읽는 것은 액션이다.
- DOM을 바꾸는 것은 액션이다.

## 함수에는 입력과 출력이 있다.

- **입력**은 함수가 계산을 하기 위한 외부 정보이다.
- **출력**은 함수 밖으로 나오는 정보나 어떤 동작이다.

#### 입력과 출력은 명시적이거나 암묵적일 수 있다.

- 인자는 명시적인 입력이다.
- 리턴값은 명시적인 출력이다.
- 하지만 암묵적으로 함수로 들어가거나 나오는 정보도 있다.
  - 전역변수를 읽는 것은 암묵적인 입력이다.
  - 콘솔에 찍는 것은 압묵적 출력이다.
  - 전역변수를 바꾸는 것도 암묵적 출력이다.

#### 함수에 암묵적 입력과 출력이 있으면 액션이 된다.

- 압묵적 입력과 출력을 **부수 효과**라고 부른다.
  - 부수 효과는 함수가 하려고 하는 주요 기능(리턴값을 계산하는 일)이 아니다.
- 암묵적 입력은 함수의 인자로 바꾼다.
- 암묵적 출력은 함수의 리턴값으로 바꾼다.

## 액션에서 계산 빼내기

- **서브루틴 추출하기**(extract subroutine)
  - 계산에 해당하는 코드를 분리한다. 그리고 입력값은 인자로 출력값은 리턴으로 바꾼다.
- 암묵적인 입력과 출력을 모두 명시적으로 바꾼다.
  - 전역변수 대신 지역변수를 사용하도록 바꾸고 지역변숫값을 리턴하도록 고친다.
  - 암묵적인 입력을 함수 인자로 바꾼다.
- **카피-온-라이트**(copy-on-write)
  - 어떤 값을 바꿀 때 그 값을 복사해서 바꾸는 방법으로 불변성을 구현하는 방법
