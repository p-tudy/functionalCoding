# 반응형 아키텍처와 어니언 아키텍처

## 두 아키텍처 패턴은 독립적이다.
#### 반응형 아키텍처
- 순차적 액션 단계에 사용한다.
- 코드에 나타난 순차적 액션의 순서를 뒤집는다.
- 효과와 그 효과에 대한 원인을 분리해서 코드에 복잡하게 꼬인 부분을 풀 수 있다.

#### 어니언 아키텍처
- 서비스의 모든 단계에 사요한다.
- 웹 서비스나 온도 조절 장치 같은 현실 세계와 상호작용하기 위한 서비스 구조를 만든다.
- 함수형 사고를 적용한다면 자연스럽게 쓸 수 있는 아키텍처이다.

## 반응형 아키텍처란?
- 애플리케이션을 구조화하는 방법이다.
- 핵심 원칙은 이벤트에 대한 반응으로 일어날 일을 지정하는 것이다.
- 웹 서비스와 UI에 잘 어울린다.
  - 웹 서비스는 웹 요청 응답에 일어날 일을 지정한다.
  - UI는 버튼 클릭과 같은 이벤트 응답에 일어날 일을 지정한다.
  - 이런 것을 일반적으로 이벤트 헨들러라고 한다.

<br />

- 이벤트 핸들러는 'X가 일어나면 Y, Z, A, B, C를 순서대로 하세요.' 같이 동작한다.
- 반응형 아키텍처에서는 하려고 하는 것만 처리한다.

## 반응형 아키텍처의 절충점
- 반응형 아키텍처는 코드에 나타난 순차적 액션의 순서를 뒤집는다.
- X를 하고 Y하는 대신, X가 일어나면 언제나 Y를 한다.
- 반드시 좋은 방법은 아니기에 목적 달성위해 선택적으로 사용해야 한다.

#### 원인과 효과가 결합한 것을 분리한다.
- 어떤 경우에는 원인과 효과(effect)를 분리하면 코드가 읽기 어려워 진다.

#### 여러 단계를 파이프라인으로 처리한다.
- 파이프라인은 함수형 도구를 연결해서 만든다.
- 반응형 아키텍처로 이와 비슷하게 액션과 계산을 조합할 수 있다.

#### 타임라인이 유연해 진다.
- 순서를 표현하는 방법을 뒤집으면 타임라인이 유연해진다.
- 물론 이러한 유연성이 기대하지 않은 실행 순서로 이어진다면 좋지 않을 수 있다.
- 익숙해지면 더 짧은 타임라인을 만들 수 있다.

## 어니언 아키텍처란?
- 어니언 아키텍처는 서비스 전체를 구성하는 데 사용하기 때문에 바깥 세계와 상호작용을 하는 부분을 다룬다.
- 어니언 아키텍처는 특정 계층이 꼭 필요하다고 강제하지 않는다.
- 하지만 3가지 큰 분류로 나눌 수 있다.
  - 인터랙션 계층 : 바깥세상에 영향을 주거나 받는 액션
  - 도메인 계층 : 비즈니스 규칙을 정의하는 계산
  - 언어 계층 : 언어 유틸리티와 라이브러리

## 전통적인 계층형 아키텍처
- 전통적인 아키텍처로 웹 API를 만들 때 계층(layer)라는 개념을 사용한다.
  - 웹 인터페이스 계층 : 웹 요청을 도메인으로 바꾸고 도메인을 웹 응답으로 바꾼다.
  - 도메인 계층 : 애플리케이션 핵심 로직으로 도메인 개념에 DB 쿼리나 명령이 들어간다.
  - 데이터베이스 계층 : 시간에 따라 바뀌는 정보를 저장한다.

## 함수형 아키텍처
- 함수형이 아닌 전통적인 아키텍처와 함수형 아키텍처의 차이
  - 데이터베이스 계층과 도메인 계층의 관계이다.
  - 함수형 아키텍처는 도메인 계층이 데이터베이스 계층에 의존하지 않는다.
    - 데이터베이스 동작은 값을 바꾸거나 데이터베이스에 접근하기 때문에 액션이다.

## 변경과 재사용이 쉬워야 한다.
- 어니언 아키텍처는 인터랙션 계층을 바꾸기 쉽다.
  - 인터랙션 계층이 가장 위에 있어서 가장 바꾸기 쉽다.